<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ramazone - Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Modern Icon Pack -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /*
         * ======================================================================
         * === HOW TO RUN THIS FILE ===
         * ======================================================================
         * 1. You must run this file from a local web server.
         * 2. Use VS Code's "Live Server" extension for the easiest setup.
         * ======================================================================
        */

        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --secondary: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
        }

        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', system-ui, sans-serif; background-color: #f3f4f6; color: #111827; }
        h1, h2, h3, h4, h5, h6 { font-family: 'Poppins', sans-serif; }

        /* === SIDEBAR STYLES === */
        .sidebar { background-image: linear-gradient(180deg, #1f2937, #111827); transition: transform 0.3s ease; }
        .sidebar-brand { background-image: linear-gradient(to right, var(--primary-dark), var(--primary)); }
        .sidebar-link { display: flex; align-items: center; padding: 0.875rem 1.5rem; color: #d1d5db; font-weight: 500; transition: all 0.2s ease; border-left: 4px solid transparent; margin: 0 0.5rem 2px 0; border-radius: 0 8px 8px 0; }
        .sidebar-link:hover { background-color: rgba(255, 255, 255, 0.08); color: #ffffff; }
        .sidebar-link.active { background-color: var(--primary); color: #ffffff; border-left-color: var(--secondary); }
        .sidebar-link i { font-size: 1.1rem; width: 1.5rem; text-align: center; margin-right: 0.875rem; color: #9ca3af; transition: all 0.2s ease; }
        .sidebar-link:hover i, .sidebar-link.active i { color: #ffffff; }

        /* === FORMS & CARDS === */
        .admin-card { background-color: #ffffff; border-radius: 0.75rem; box-shadow: 0 1px 3px rgba(0,0,0,0.05), 0 1px 2px rgba(0,0,0,0.03); border: 1px solid #e5e7eb; }
        .card-header { padding: 1rem 1.5rem; border-bottom: 1px solid #e5e7eb; background-color: #f9fafb; }
        .card-header h3 { font-size: 1.125rem; font-weight: 600; }
        .card-body { padding: 1.5rem; }
        .card-footer { padding: 1rem 1.5rem; border-top: 1px solid #e5e7eb; background-color: #f9fafb; }
        .form-label { display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem; }
        .form-control { width: 100%; border: 1px solid #d1d5db; border-radius: 0.5rem; padding: 0.625rem 0.875rem; transition: all 0.15s ease; }
        .form-control:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2); outline: none; }
        .form-file-preview { width: 100%; aspect-ratio: 16 / 9; border-radius: 0.5rem; background-color: #f3f4f6; border: 2px dashed #d1d5db; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; cursor: pointer; }
        .form-file-preview:hover { border-color: var(--primary); }
        .form-file-preview img { width: 100%; height: 100%; object-fit: contain; }
        .form-file-preview .placeholder { color: #9ca3af; text-align: center; }
        .form-file-preview img:not([src=""]) + .placeholder { display: none; }
        .form-file-upload { opacity: 0; position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: pointer; }

        /* === BUTTONS === */
        .btn { display: inline-flex; align-items: center; justify-content: center; padding: 0.625rem 1.25rem; border-radius: 0.5rem; font-weight: 500; transition: all 0.15s ease; border: none; }
        .btn:focus { outline: none; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-primary { background-color: var(--primary); color: white; }
        .btn-primary:hover:not(:disabled) { background-color: var(--primary-dark); }
        .btn-danger { background-color: var(--danger); color: white; }
        .btn-danger:hover:not(:disabled) { background-color: #c82333; }

        /* === ITEM CARDS (for lists) === */
        .item-card { background-color: white; border-radius: 0.5rem; border: 1px solid #e5e7eb; position: relative; }
        .item-card-header { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 1.25rem; border-bottom: 1px solid #f3f4f6; }
        .item-card-title { font-weight: 600; color: #111827; }
        .item-card-body { padding: 1.25rem; }

        /* === LOADER === */
        .loader { border-radius: 50%; width: 40px; height: 40px; margin: 0 auto; border-top: 5px solid rgba(79, 70, 229, 0.2); border-right: 5px solid rgba(79, 70, 229, 0.2); border-bottom: 5px solid rgba(79, 70, 229, 0.2); border-left: 5px solid var(--primary); transform: translateZ(0); animation: loader 1.1s infinite linear; }
        @keyframes loader { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* === LOGIN PAGE === */
        .auth-container { min-height: 100vh; background-image: linear-gradient(135deg, #4f46e5, #3730a3); display: flex; align-items: center; justify-content: center; padding: 1rem; }
        .auth-card { width: 100%; max-width: 420px; background-color: white; border-radius: 1rem; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }
        .auth-header { padding: 2rem; background-image: linear-gradient(to right, #4f46e5, #6366f1); color: white; text-align: center; }
        .auth-logo { width: 80px; height: 80px; margin: 0 auto 1rem; background-color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; color: var(--primary); box-shadow: 0 0 0 5px rgba(255,255,255,0.2); }

        /* === NOTIFICATION === */
        #toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 0.5rem; }
        .toast { padding: 1rem; border-radius: 0.5rem; background-color: white; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); display: flex; align-items: center; max-width: 350px; transform: translateX(calc(100% + 20px)); opacity: 0; transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
        .toast.show { transform: translateX(0); opacity: 1; }
        .toast-icon { margin-right: 0.75rem; width: 24px; height: 24px; border-radius: 50%; flex-shrink: 0; display: flex; align-items: center; justify-content: center; color: white; }
        .toast-progress { position: absolute; bottom: 0; left: 0; height: 3px; width: 100%; background-color: rgba(0,0,0,0.1); }
        .toast-progress-bar { height: 100%; width: 0; transition: width linear; }
        .toast-success .toast-icon, .toast-success .toast-progress-bar { background-color: var(--success); }
        .toast-error .toast-icon, .toast-error .toast-progress-bar { background-color: var(--danger); }
        .toast-info .toast-icon, .toast-info .toast-progress-bar { background-color: var(--primary); }

        /* === ANIMATIONS === */
        .page-enter-active { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Authentication Page -->
    <div id="authOverlay" class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <div class="auth-logo"><i class="fas fa-store"></i></div>
                <h2 class="text-2xl font-bold">Ramazone Admin</h2>
                <p class="mt-2 text-white text-opacity-80">Sign in to your admin account</p>
            </div>
            <div class="p-8">
                <form id="loginForm" class="space-y-6">
                    <div>
                        <label for="adminEmail" class="form-label"><i class="fas fa-envelope text-gray-400 mr-2"></i>Email Address</label>
                        <input type="email" id="adminEmail" value="ramazone007@gmail.com" required class="form-control" placeholder="Enter your email">
                    </div>
                    <div>
                        <label for="adminPassword" class="form-label"><i class="fas fa-lock text-gray-400 mr-2"></i>Password</label>
                        <div class="relative">
                            <input type="password" id="adminPassword" value="Pk79036@" required class="form-control" placeholder="Enter your password">
                            <button type="button" id="togglePassword" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700"><i class="fas fa-eye"></i></button>
                        </div>
                    </div>
                    <button id="authButton" type="submit" class="w-full btn btn-primary py-3 font-semibold text-base"><span id="buttonText">Sign In</span><i class="fas fa-sign-in-alt ml-2"></i></button>
                </form>
                <div id="running-locally-warning" class="mt-6 bg-yellow-50 text-yellow-700 p-3 rounded-md text-sm border border-yellow-200 hidden">
                    <p class="font-semibold"><i class="fas fa-exclamation-triangle mr-2"></i>Important Notice: Use a local server.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Admin Layout -->
    <div id="adminLayout" class="hidden">
        <aside id="sidebar" class="sidebar w-64 fixed inset-y-0 left-0 z-20 transform -translate-x-full md:translate-x-0">
            <div class="flex flex-col h-full">
                <div class="sidebar-brand h-16 flex items-center justify-center px-4 shadow-md flex-shrink-0">
                    <div class="flex items-center space-x-3">
                        <div class="bg-white p-1.5 rounded-md"><i class="fas fa-store text-xl text-primary"></i></div>
                        <h1 class="text-xl font-bold text-white">Ramazone</h1>
                    </div>
                </div>
                <div class="flex-1 overflow-y-auto py-5">
                    <nav class="space-y-1">
                        <a href="#" data-target="slider-section" class="sidebar-link active"><i class="fas fa-images"></i><span>Slider</span></a>
                        <a href="#" data-target="marquee-section" class="sidebar-link"><i class="fas fa-stream"></i><span>Brand Marquee</span></a>
                        <a href="#" data-target="search-section" class="sidebar-link"><i class="fas fa-search"></i><span>Search Section</span></a>
                        <a href="#" data-target="special-categories-section" class="sidebar-link"><i class="fas fa-star"></i><span>Special Categories</span></a>
                        <a href="#" data-target="normal-categories-section" class="sidebar-link"><i class="fas fa-th-list"></i><span>Normal Categories</span></a>
                        <a href="#" data-target="festive-section" class="sidebar-link"><i class="fas fa-gifts"></i><span>Festive Collection</span></a>
                        <a href="#" data-target="dynamic-sections-section" class="sidebar-link"><i class="fas fa-layer-group"></i><span>Dynamic Sections</span></a>
                        <a href="#" data-target="info-marquee-section" class="sidebar-link"><i class="fas fa-info-circle"></i><span>Info Marquee</span></a>
                        <a href="#" data-target="sponsor-section" class="sidebar-link"><i class="fas fa-ad"></i><span>Sponsor</span></a>
                        <a href="#" data-target="flipcard-section" class="sidebar-link"><i class="fas fa-clone"></i><span>Flip Card</span></a>
                        <a href="#" data-target="advantages-section" class="sidebar-link"><i class="fas fa-check-circle"></i><span>Advantages</span></a>
                        <a href="#" data-target="footer-section" class="sidebar-link"><i class="fas fa-link"></i><span>Footer & Social</span></a>
                    </nav>
                </div>
                <div class="p-4 border-t border-gray-700 mt-auto flex-shrink-0">
                    <button id="signOutButton" class="w-full btn btn-light hover:bg-gray-200"><i class="fas fa-sign-out-alt mr-2"></i><span>Sign Out</span></button>
                </div>
            </div>
        </aside>

        <div class="md:ml-64 flex-1 flex flex-col">
            <header class="bg-white shadow-sm h-16 flex items-center justify-between px-6 flex-shrink-0 sticky top-0 z-10">
                <div class="flex items-center">
                    <button id="sidebarToggle" class="text-gray-500 focus:outline-none md:hidden mr-4"><i class="fas fa-bars text-lg"></i></button>
                    <h2 id="contentTitle" class="text-xl font-semibold text-gray-800">Slider</h2>
                </div>
            </header>
            <main id="main-content-area" class="flex-1 overflow-y-auto p-6">
                <div id="adminLoadingIndicator" class="text-center py-20">
                    <div class="loader"></div>
                    <p class="text-primary font-medium mt-6">Loading Data...</p>
                </div>
                <div id="sections-container" class="hidden">
                    <section id="slider-section" class="content-section hidden"></section>
                    <section id="marquee-section" class="content-section hidden"></section>
                    <section id="search-section" class="content-section hidden"></section>
                    <section id="special-categories-section" class="content-section hidden"></section>
                    <section id="normal-categories-section" class="content-section hidden"></section>
                    <section id="festive-section" class="content-section hidden"></section>
                    <section id="dynamic-sections-section" class="content-section hidden"></section>
                    <section id="info-marquee-section" class="content-section hidden"></section>
                    <section id="sponsor-section" class="content-section hidden"></section>
                    <section id="flipcard-section" class="content-section hidden"></section>
                    <section id="advantages-section" class="content-section hidden"></section>
                    <section id="footer-section" class="content-section hidden"></section>
                </div>
            </main>
        </div>
        <div id="sidebarOverlay" class="fixed inset-0 bg-black opacity-50 z-10 hidden md:hidden"></div>
    </div>

    <div id="toast-container"></div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <script>
        // --- CONFIGURATIONS ---
        const firebaseConfig = {
            apiKey: "AIzaSyAgzs3GqaafEHQSnEyZqrjQT0r_6jXMaGQ",
            authDomain: "re-store-7f2b3.firebaseapp.com",
            databaseURL: "https://re-store-7f2b3-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "re-store-7f2b3",
            storageBucket: "re-store-7f2b3.appspot.com",
            messagingSenderId: "774895588253",
            appId: "1:774895588253:web:dad6c40fed92bce7c39574"
        };
        const IMGBB_API_KEY = '65bbcf742486328061382f03949b47c6';
        const IMGBB_UPLOAD_URL = 'https://api.imgbb.com/1/upload';
        const DB_BASE_PATH = 'ramazone/homepage';
        const ADMIN_UID = 'U5qHhCFEJEWD1dU8cHDkbVe3cpv1';

        // --- GLOBAL VARIABLES ---
        let app, auth, db;

        // --- UTILITY FUNCTIONS ---
        const showToast = (title, message, type = 'info', duration = 5000) => {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            const iconClass = type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle';
            toast.innerHTML = `<div class="toast-icon"><i class="fas ${iconClass}"></i></div><div class="flex-1"><div class="font-semibold">${title}</div><div class="text-sm text-gray-600">${message}</div></div><div class="toast-progress"><div class="toast-progress-bar"></div></div>`;
            container.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 10);
            const progressBar = toast.querySelector('.toast-progress-bar');
            progressBar.style.transitionDuration = `${duration}ms`;
            setTimeout(() => progressBar.style.width = '100%', 50);
            setTimeout(() => { toast.classList.remove('show'); setTimeout(() => toast.remove(), 500); }, duration);
        };
        
        const uploadImage = async (file) => {
            if (!file) return null;
            const formData = new FormData();
            formData.append('key', IMGBB_API_KEY);
            formData.append('image', file);
            showToast('Uploading...', `Uploading ${file.name}`, 'info', 10000);
            const response = await fetch(IMGBB_UPLOAD_URL, { method: 'POST', body: formData });
            const result = await response.json();
            if (!result.success) throw new Error(result.error.message || 'Image upload failed');
            return result.data.url;
        };
        
        const setupImagePreview = (container) => {
            container.addEventListener('change', (e) => {
                if (e.target.matches('.form-file-upload')) {
                    const file = e.target.files[0];
                    if (file) {
                        const previewImg = e.target.closest('.form-file-preview').querySelector('img');
                        const reader = new FileReader();
                        reader.onload = (event) => { previewImg.src = event.target.result; };
                        reader.readAsDataURL(file);
                    }
                }
            });
        };

        // --- DYNAMIC CONTENT RENDERING ---
        const createItemCard = (title, contentHtml, data) => {
            const card = document.createElement('div');
            card.className = 'item-card';
            card.innerHTML = `
                <div class="item-card-header">
                    <h4 class="item-card-title">${title}</h4>
                    <button type="button" class="btn btn-danger btn-sm"><i class="fas fa-trash-alt"></i></button>
                </div>
                <div class="item-card-body">${contentHtml}</div>
            `;
            card.querySelector('.btn-danger').addEventListener('click', () => card.remove());
            if (data) {
                for (const key in data) {
                    const input = card.querySelector(`[data-key="${key}"]`);
                    if (!input) continue;
                    if (input.type === 'file') {
                        const preview = card.querySelector(`[data-preview-for="${key}"]`);
                        if (preview) preview.src = data[key] || '';
                    } else {
                        input.value = data[key] || '';
                    }
                }
            }
            return card;
        };

        const renderListSection = (sectionId, dbKey, sectionTitle, itemTitle, itemHtml, data, dataKeys) => {
            const section = document.getElementById(sectionId);
            section.innerHTML = `
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">${sectionTitle}</h2>
                    <button class="btn btn-primary add-item-btn"><i class="fas fa-plus mr-2"></i> Add ${itemTitle}</button>
                </div>
                <form class="list-form">
                    <div class="space-y-4 item-container"></div>
                    <div class="flex justify-end mt-6">
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save mr-2"></i> Save Section</button>
                    </div>
                </form>
            `;
            
            const container = section.querySelector('.item-container');
            if (data) data.forEach(item => container.appendChild(createItemCard(itemTitle, itemHtml, item)));
            
            section.querySelector('.add-item-btn').addEventListener('click', () => {
                container.appendChild(createItemCard(itemTitle, itemHtml));
            });
            
            section.querySelector('.list-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                showToast('Saving...', `Saving ${sectionTitle}`, 'info');
                try {
                    const items = [];
                    for (const card of container.children) {
                        const itemData = {};
                        for (const key of dataKeys) {
                            const input = card.querySelector(`[data-key="${key}"]`);
                            if (input.type === 'file') {
                                let imageUrl = card.querySelector(`[data-preview-for="${key}"]`).src;
                                if (input.files[0]) imageUrl = await uploadImage(input.files[0]);
                                itemData[key] = imageUrl;
                            } else {
                                itemData[key] = input.value;
                            }
                        }
                        items.push(itemData);
                    }
                    await db.ref(`${DB_BASE_PATH}/${dbKey}`).set(items);
                    showToast('Success', `${sectionTitle} saved successfully!`, 'success');
                } catch (err) {
                    showToast('Error', `Failed to save: ${err.message}`, 'error');
                }
            });
            setupImagePreview(container);
        };
        
        const renderSingleFormSection = (sectionId, dbKey, sectionTitle, formHtml, data, saveHandler) => {
            const section = document.getElementById(sectionId);
            section.innerHTML = `
                <div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-bold text-gray-800">${sectionTitle}</h2></div>
                <form id="${sectionId}-form" class="admin-card">
                    <div class="card-body">${formHtml}</div>
                    <div class="card-footer flex justify-end">
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save mr-2"></i> Save Section</button>
                    </div>
                </form>
            `;
            if (data) {
                for (const key in data) {
                    const input = section.querySelector(`[data-key="${key}"]`);
                    if (input) {
                        if (input.type === 'file') {
                           const preview = section.querySelector(`[data-preview-for="${key}"]`);
                           if(preview) preview.src = data[key] || '';
                        } else {
                           input.value = data[key] || '';
                        }
                    }
                }
            }
            setupImagePreview(section);
            section.querySelector('form').addEventListener('submit', saveHandler);
        };
        
        // --- ALL SECTIONS IMPLEMENTATION ---
        
        const renderAllSections = (data) => {
            const imageAndLinkHtml = `<div class="form-group"><label class="form-label">Link URL</label><input type="url" class="form-control" data-key="linkUrl" placeholder="https://example.com"></div><div class="form-group"><label class="form-label">Image</label><div class="form-file-preview"><img data-preview-for="imageUrl" src=""><div class="placeholder"><i class="fas fa-image text-2xl"></i><p>Upload Image</p></div><input type="file" class="form-file-upload" data-key="imageUrl" accept="image/*"></div></div>`;
            renderListSection('slider-section', 'slider', 'Homepage Slider', 'Slide', imageAndLinkHtml, data.slider, ['linkUrl', 'imageUrl']);
            renderListSection('marquee-section', 'imageMarquee', 'Brand Marquee', 'Brand', imageAndLinkHtml, data.imageMarquee, ['linkUrl', 'imageUrl']);

            const categoryHtml = `<div class="form-group"><label class="form-label">Name</label><input type="text" class="form-control" data-key="name" placeholder="Category Name"></div>${imageAndLinkHtml}`;
            renderListSection('special-categories-section', 'specialCategories', 'Special Categories', 'Category', categoryHtml, data.specialCategories, ['name', 'linkUrl', 'imageUrl']);
            renderListSection('normal-categories-section', 'normalCategories', 'Normal Categories', 'Category', categoryHtml, data.normalCategories, ['name', 'linkUrl', 'imageUrl']);

            renderSearchSection(data.search);
            renderFestiveSection(data.festiveCollection);
            renderDynamicSections(data.dynamicSection1, data.dynamicSection2);
            renderInfoMarqueeSection(data.infoMarquee);
            renderSponsorSection(data.sponsor);
            renderFlipCardSection(data.flipCard);
            renderAdvantagesSection(data.advantages);
            renderFooterSection(data.footer);
        };

        const renderSearchSection = (data) => {
            const formHtml = `<div class="form-group"><label class="form-label">Redirect URL</label><input type="url" class="form-control" data-key="redirectUrl"></div><div class="form-group"><label class="form-label">Scrolling Texts (comma-separated)</label><input type="text" class="form-control" data-key="scrollingTexts"></div>`;
            renderSingleFormSection('search-section', 'search', 'Search Section', formHtml, { ...data, scrollingTexts: (data?.scrollingTexts || []).join(', ') }, async (e) => {
                e.preventDefault();
                showToast('Saving...', 'Saving Search Section', 'info');
                try {
                    const redirectUrl = e.target.querySelector('[data-key="redirectUrl"]').value;
                    const scrollingTexts = e.target.querySelector('[data-key="scrollingTexts"]').value.split(',').map(s => s.trim()).filter(Boolean);
                    await db.ref(`${DB_BASE_PATH}/search`).set({ redirectUrl, scrollingTexts });
                    showToast('Success', 'Search Section saved!', 'success');
                } catch (err) { showToast('Error', err.message, 'error'); }
            });
        };
        
        const renderFestiveSection = (data) => {
            const section = document.getElementById('festive-section');
            data = data || {};
            section.innerHTML = `
                <div class="mb-6"><h2 class="text-2xl font-bold text-gray-800">Festive Collection</h2></div>
                <form id="festive-form">
                    <div class="admin-card mb-6"><div class="card-body grid md:grid-cols-2 gap-6">
                        <div class="form-group"><label class="form-label">Section Title</label><input type="text" class="form-control" id="festive-title" value="${data.title || ''}"></div>
                        <div class="form-group"><label class="form-label">Background Image</label><div class="form-file-preview"><img id="festive-bg-preview" src="${data.backgroundImageUrl || ''}"><input type="file" id="festive-bg-image" class="form-file-upload" accept="image/*"></div></div>
                    </div></div>
                    <div class="flex justify-between items-center mb-4"><h3 class="text-xl font-bold text-gray-800">Products</h3><button type="button" id="add-festive-product-btn" class="btn btn-primary"><i class="fas fa-plus mr-2"></i>Add Product</button></div>
                    <div id="festive-products-container" class="space-y-4"></div>
                    <div class="flex justify-end mt-6"><button type="submit" class="btn btn-primary"><i class="fas fa-save mr-2"></i>Save Festive Section</button></div>
                </form>`;
            
            const container = section.querySelector('#festive-products-container');
            const productHtml = `<div class="grid md:grid-cols-2 gap-6">
                <div class="form-group"><label class="form-label">Name</label><input type="text" class="form-control" data-key="name"></div>
                <div class="form-group"><label class="form-label">Offer Text</label><input type="text" class="form-control" data-key="offer"></div>
                <div class="form-group"><label class="form-label">Link URL</label><input type="url" class="form-control" data-key="linkUrl"></div>
                <div class="form-group"><label class="form-label">Image</label><div class="form-file-preview"><img data-preview-for="imageUrl" src=""><input type="file" class="form-file-upload" data-key="imageUrl" accept="image/*"></div></div>
            </div>`;

            if (data.products) data.products.forEach(p => container.appendChild(createItemCard('Product', productHtml, p)));
            section.querySelector('#add-festive-product-btn').addEventListener('click', () => container.appendChild(createItemCard('Product', productHtml)));
            
            section.querySelector('#festive-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                showToast('Saving...', 'Saving Festive Collection', 'info');
                try {
                    let backgroundImageUrl = section.querySelector('#festive-bg-preview').src;
                    if(section.querySelector('#festive-bg-image').files[0]) backgroundImageUrl = await uploadImage(section.querySelector('#festive-bg-image').files[0]);

                    const products = [];
                    for(const card of container.children) {
                        let imageUrl = card.querySelector('[data-preview-for="imageUrl"]').src;
                        if(card.querySelector('[data-key="imageUrl"]').files[0]) imageUrl = await uploadImage(card.querySelector('[data-key="imageUrl"]').files[0]);
                        products.push({
                            name: card.querySelector('[data-key="name"]').value,
                            offer: card.querySelector('[data-key="offer"]').value,
                            linkUrl: card.querySelector('[data-key="linkUrl"]').value,
                            imageUrl
                        });
                    }
                    await db.ref(`${DB_BASE_PATH}/festiveCollection`).set({ title: section.querySelector('#festive-title').value, backgroundImageUrl, products });
                    showToast('Success', 'Festive Collection saved!', 'success');
                } catch(err) { showToast('Error', err.message, 'error'); }
            });
            setupImagePreview(section);
        };

        const renderDynamicSections = (data1, data2) => {
            const section = document.getElementById('dynamic-sections-section');
            data1 = data1 || {}; data2 = data2 || {};
            const formHtml = (num, d) => `<div class="admin-card">
                <div class="card-header"><h3>Section ${num}</h3></div>
                <form id="dynamic-section-${num}-form" class="card-body space-y-4">
                    <input type="hidden" data-key="id" value="dynamicSection${num}">
                    <div><label class="form-label">Title</label><input type="text" class="form-control" data-key="title" value="${d.title || ''}"></div>
                    <div><label class="form-label">Title Color</label><input type="color" class="form-control h-10" data-key="titleColor" value="${d.titleColor || '#000000'}"></div>
                    <div><label class="form-label">Text</label><input type="text" class="form-control" data-key="text" value="${d.text || ''}"></div>
                    <div><label class="form-label">Button Text</label><input type="text" class="form-control" data-key="buttonText" value="${d.buttonText || ''}"></div>
                    <div><label class="form-label">Link URL</label><input type="url" class="form-control" data-key="linkUrl" value="${d.linkUrl || ''}"></div>
                    <div><label class="form-label">Image</label><div class="form-file-preview"><img data-preview-for="imageUrl" src="${d.imageUrl || ''}"><input type="file" class="form-file-upload" data-key="imageUrl" accept="image/*"></div></div>
                    <div class="flex justify-end"><button type="submit" class="btn btn-primary"><i class="fas fa-save mr-2"></i>Save Section ${num}</button></div>
                </form></div>`;
            
            section.innerHTML = `<div class="mb-6"><h2 class="text-2xl font-bold text-gray-800">Dynamic Info Sections</h2></div><div class="grid lg:grid-cols-2 gap-6">${formHtml(1, data1)}${formHtml(2, data2)}</div>`;
            
            const saveHandler = async (e) => {
                e.preventDefault();
                const form = e.target;
                const id = form.querySelector('[data-key="id"]').value;
                showToast('Saving...', `Saving ${id}`, 'info');
                try {
                    let imageUrl = form.querySelector('[data-preview-for="imageUrl"]').src;
                    if(form.querySelector('[data-key="imageUrl"]').files[0]) imageUrl = await uploadImage(form.querySelector('[data-key="imageUrl"]').files[0]);
                    const saveData = {
                        title: form.querySelector('[data-key="title"]').value,
                        titleColor: form.querySelector('[data-key="titleColor"]').value,
                        text: form.querySelector('[data-key="text"]').value,
                        buttonText: form.querySelector('[data-key="buttonText"]').value,
                        linkUrl: form.querySelector('[data-key="linkUrl"]').value,
                        imageUrl
                    };
                    await db.ref(`${DB_BASE_PATH}/${id}`).set(saveData);
                    showToast('Success', `${id} saved!`, 'success');
                } catch(err) { showToast('Error', err.message, 'error'); }
            };
            section.querySelector('#dynamic-section-1-form').addEventListener('submit', saveHandler);
            section.querySelector('#dynamic-section-2-form').addEventListener('submit', saveHandler);
            setupImagePreview(section);
        };

        const renderInfoMarqueeSection = (data) => {
            renderSingleFormSection('info-marquee-section', 'infoMarquee', 'Info Marquee', `<div><label class="form-label">Marquee Text</label><input type="text" class="form-control" data-key="text"></div>`, {text: data}, async (e) => {
                e.preventDefault();
                showToast('Saving...', 'Saving Info Marquee', 'info');
                try {
                    await db.ref(`${DB_BASE_PATH}/infoMarquee`).set(e.target.querySelector('[data-key="text"]').value);
                    showToast('Success', 'Info Marquee saved!', 'success');
                } catch(err) { showToast('Error', err.message, 'error'); }
            });
        };

        const renderSponsorSection = (data) => {
            const formHtml = `<div class="form-group"><label class="form-label">Link URL</label><input type="url" class="form-control" data-key="linkUrl"></div><div class="form-group"><label class="form-label">Image</label><div class="form-file-preview"><img data-preview-for="imageUrl" src=""><input type="file" class="form-file-upload" data-key="imageUrl" accept="image/*"></div></div>`;
            renderSingleFormSection('sponsor-section', 'sponsor', 'Sponsor Section', formHtml, data, async (e) => {
                e.preventDefault();
                showToast('Saving...', 'Saving Sponsor Section', 'info');
                try {
                    let imageUrl = e.target.querySelector('[data-preview-for="imageUrl"]').src;
                    if(e.target.querySelector('[data-key="imageUrl"]').files[0]) imageUrl = await uploadImage(e.target.querySelector('[data-key="imageUrl"]').files[0]);
                    await db.ref(`${DB_BASE_PATH}/sponsor`).set({ linkUrl: e.target.querySelector('[data-key="linkUrl"]').value, imageUrl });
                    showToast('Success', 'Sponsor Section saved!', 'success');
                } catch(err) { showToast('Error', err.message, 'error'); }
            });
        };
        
        const renderFlipCardSection = (data) => {
            const section = document.getElementById('flipcard-section');
            data = data || { front: {}, back: {} };
            section.innerHTML = `<div class="mb-6"><h2 class="text-2xl font-bold text-gray-800">Flip Card</h2></div>
                <form id="flipcard-form">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="admin-card"><div class="card-header"><h3>Front Side</h3></div><div class="card-body space-y-4">
                            <div><label class="form-label">Link URL</label><input type="url" class="form-control" id="flipcard-front-link" value="${data.front.linkUrl || ''}"></div>
                            <div><label class="form-label">Image</label><div class="form-file-preview"><img id="flipcard-front-preview" src="${data.front.imageUrl || ''}"><input type="file" id="flipcard-front-image" class="form-file-upload" accept="image/*"></div></div>
                        </div></div>
                        <div class="admin-card"><div class="card-header"><h3>Back Side</h3></div><div class="card-body space-y-4">
                            <div><label class="form-label">Link URL</label><input type="url" class="form-control" id="flipcard-back-link" value="${data.back.linkUrl || ''}"></div>
                            <div><label class="form-label">Image</label><div class="form-file-preview"><img id="flipcard-back-preview" src="${data.back.imageUrl || ''}"><input type="file" id="flipcard-back-image" class="form-file-upload" accept="image/*"></div></div>
                        </div></div>
                    </div>
                    <div class="flex justify-center mt-6"><button type="submit" class="btn btn-primary"><i class="fas fa-save mr-2"></i> Save Flip Card</button></div>
                </form>`;
            setupImagePreview(section);
            section.querySelector('#flipcard-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                showToast('Saving...', 'Saving Flip Card', 'info');
                try {
                    let frontImageUrl = document.getElementById('flipcard-front-preview').src;
                    let backImageUrl = document.getElementById('flipcard-back-preview').src;
                    if (document.getElementById('flipcard-front-image').files[0]) frontImageUrl = await uploadImage(document.getElementById('flipcard-front-image').files[0]);
                    if (document.getElementById('flipcard-back-image').files[0]) backImageUrl = await uploadImage(document.getElementById('flipcard-back-image').files[0]);
                    await db.ref(`${DB_BASE_PATH}/flipCard`).set({
                        front: { linkUrl: document.getElementById('flipcard-front-link').value, imageUrl: frontImageUrl },
                        back: { linkUrl: document.getElementById('flipcard-back-link').value, imageUrl: backImageUrl }
                    });
                    showToast('Success', 'Flip Card saved!', 'success');
                } catch (err) { showToast('Error', err.message, 'error'); }
            });
        };

        const renderAdvantagesSection = (data) => {
            const section = document.getElementById('advantages-section');
            section.innerHTML = `<div class="mb-6"><h2 class="text-2xl font-bold text-gray-800">Advantages Section</h2></div>
                <form id="advantages-form">
                    <div id="advantages-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
                    <div class="flex justify-center mt-6"><button type="submit" class="btn btn-primary"><i class="fas fa-save mr-2"></i> Save Advantages</button></div>
                </form>`;
            const container = section.querySelector('#advantages-container');
            const advantages = data && data.length === 4 ? data : [{}, {}, {}, {}];
            advantages.forEach((item, i) => {
                const card = document.createElement('div');
                card.className = 'admin-card';
                card.innerHTML = `<div class="card-header"><h3>Advantage ${i + 1}</h3></div><div class="card-body space-y-4">
                    <div><label class="form-label">Title</label><input type="text" class="form-control data-title" value="${item.title || ''}"></div>
                    <div><label class="form-label">Image</label><div class="form-file-preview"><img class="data-imageUrl-preview" src="${item.imageUrl || ''}"><input type="file" class="form-file-upload data-imageUrl" accept="image/*"></div></div>
                </div>`;
                container.appendChild(card);
            });
            setupImagePreview(container);
            section.querySelector('#advantages-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                showToast('Saving...', 'Saving Advantages', 'info');
                try {
                    const items = [];
                    for(const card of container.children) {
                        let imageUrl = card.querySelector('.data-imageUrl-preview').src;
                        if (card.querySelector('.data-imageUrl').files[0]) imageUrl = await uploadImage(card.querySelector('.data-imageUrl').files[0]);
                        items.push({ title: card.querySelector('.data-title').value, imageUrl });
                    }
                    await db.ref(`${DB_BASE_PATH}/advantages`).set(items);
                    showToast('Success', 'Advantages saved!', 'success');
                } catch (err) { showToast('Error', err.message, 'error'); }
            });
        };

        const renderFooterSection = (data) => {
            const section = document.getElementById('footer-section');
            data = data || { followLinks: {} };
            const formHtml = `<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="form-group"><label class="form-label">Shop Link</label><input type="url" class="form-control" data-key="shopLink" value="${data.shopLink || ''}"></div>
                <div class="form-group"><label class="form-label">Play Link</label><input type="url" class="form-control" data-key="playLink" value="${data.playLink || ''}"></div>
                <div class="form-group"><label class="form-label">Profile Link</label><input type="url" class="form-control" data-key="profileLink" value="${data.profileLink || ''}"></div>
                <div class="form-group"><label class="form-label">YouTube Link</label><input type="url" class="form-control" data-key="youtube" value="${data.followLinks.youtube || ''}"></div>
                <div class="form-group"><label class="form-label">Facebook Link</label><input type="url" class="form-control" data-key="facebook" value="${data.followLinks.facebook || ''}"></div>
                <div class="form-group"><label class="form-label">Instagram Link</label><input type="url" class="form-control" data-key="instagram" value="${data.followLinks.instagram || ''}"></div>
                <div class="form-group"><label class="form-label">WhatsApp Link</label><input type="url" class="form-control" data-key="whatsapp" value="${data.followLinks.whatsapp || ''}"></div>
            </div>`;
            renderSingleFormSection('footer-section', 'footer', 'Footer & Social Links', {}, async (e) => {
                e.preventDefault();
                showToast('Saving...', 'Saving Footer Links', 'info');
                try {
                    const saveData = {
                        shopLink: e.target.querySelector('[data-key="shopLink"]').value,
                        playLink: e.target.querySelector('[data-key="playLink"]').value,
                        profileLink: e.target.querySelector('[data-key="profileLink"]').value,
                        followLinks: {
                            youtube: e.target.querySelector('[data-key="youtube"]').value,
                            facebook: e.target.querySelector('[data-key="facebook"]').value,
                            instagram: e.target.querySelector('[data-key="instagram"]').value,
                            whatsapp: e.target.querySelector('[data-key="whatsapp"]').value,
                        }
                    };
                    await db.ref(`${DB_BASE_PATH}/footer`).set(saveData);
                    showToast('Success', 'Footer Links saved!', 'success');
                } catch(err) { showToast('Error', err.message, 'error'); }
            });
            // Manual data population for nested object
            const form = section.querySelector('form');
            for (const key in data) {
                if (key !== 'followLinks') form.querySelector(`[data-key="${key}"]`).value = data[key] || '';
            }
            for (const key in data.followLinks) {
                form.querySelector(`[data-key="${key}"]`).value = data.followLinks[key] || '';
            }
        };

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            if (window.location.protocol === 'file:') {
                document.getElementById('running-locally-warning').classList.remove('hidden');
            }
            try {
                app = firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                db = firebase.database();
                
                auth.onAuthStateChanged(user => {
                    const sectionsContainer = document.getElementById('sections-container');
                    const adminLoading = document.getElementById('adminLoadingIndicator');
                    if (user && user.uid === ADMIN_UID) {
                        document.getElementById('authOverlay').style.display = 'none';
                        document.getElementById('adminLayout').classList.remove('hidden');
                        adminLoading.classList.remove('hidden');
                        sectionsContainer.classList.add('hidden');
                        db.ref(DB_BASE_PATH).get().then(snapshot => {
                            renderAllSections(snapshot.val() || {});
                            adminLoading.classList.add('hidden');
                            sectionsContainer.classList.remove('hidden');
                            document.querySelector('.sidebar-link.active').click();
                            showToast('Welcome!', 'Admin panel loaded successfully.', 'success');
                        }).catch(err => showToast('Error', err.message, 'error'));
                    } else {
                        if(user) auth.signOut();
                        document.getElementById('authOverlay').style.display = 'flex';
                        document.getElementById('adminLayout').classList.add('hidden');
                    }
                });
                
                document.getElementById('loginForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const btn = document.getElementById('authButton');
                    btn.disabled = true;
                    btn.querySelector('span').textContent = 'Signing In...';
                    auth.signInWithEmailAndPassword(document.getElementById('adminEmail').value, document.getElementById('adminPassword').value)
                        .catch(err => {
                            showToast('Login Failed', err.message, 'error');
                            btn.disabled = false;
                            btn.querySelector('span').textContent = 'Sign In';
                        });
                });
                
                document.getElementById('signOutButton').addEventListener('click', () => auth.signOut());
                
                document.getElementById('togglePassword').addEventListener('click', (e) => {
                    const input = document.getElementById('adminPassword');
                    const icon = e.currentTarget.querySelector('i');
                    const isPassword = input.type === 'password';
                    input.type = isPassword ? 'text' : 'password';
                    icon.className = `fas ${isPassword ? 'fa-eye-slash' : 'fa-eye'}`;
                });

                const sidebar = document.getElementById('sidebar');
                const sidebarOverlay = document.getElementById('sidebarOverlay');
                document.getElementById('sidebarToggle').addEventListener('click', () => {
                    sidebar.classList.toggle('-translate-x-full');
                    sidebarOverlay.classList.toggle('hidden');
                });
                sidebarOverlay.addEventListener('click', () => {
                    sidebar.classList.add('-translate-x-full');
                    sidebarOverlay.classList.add('hidden');
                });
                
                document.querySelectorAll('.sidebar-link').forEach(link => {
                    link.addEventListener('click', e => {
                        e.preventDefault();
                        document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
                        link.classList.add('active');
                        document.querySelectorAll('.content-section').forEach(s => s.classList.add('hidden'));
                        const targetSection = document.getElementById(link.dataset.target);
                        if (targetSection) {
                            targetSection.classList.remove('hidden');
                            targetSection.classList.add('page-enter-active');
                        }
                        document.getElementById('contentTitle').textContent = link.querySelector('span').textContent;
                        if (window.innerWidth < 768) {
                            sidebar.classList.add('-translate-x-full');
                            sidebarOverlay.classList.add('hidden');
                        }
                    });
                });

            } catch (error) {
                showToast("Fatal Error", "Could not initialize Firebase. Check console.", 'error');
                console.error("Firebase Init Error:", error);
            }
        });
    </script>
</body>
</html>

